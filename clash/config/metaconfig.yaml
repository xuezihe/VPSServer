# å®˜æ–¹å‚è€ƒé…ç½® https://github.com/MetaCubeX/Clash.Meta/blob/Alpha/docs/config.yaml
# å®˜æ–¹é…ç½®è¯¦è§£ https://wiki.metacubex.one/config/

mixed-port: 7890
allow-lan: true
bind-address: "*"
find-process-mode: strict
mode: rule
#è‡ªå®šä¹‰ geodata url
geodata-mode: true
geodata-loader: memconservative
geox-url:
  geoip: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"
global-ua: clash.meta
log-level: info
ipv6: true
# RESTful API ç›‘å¬åœ°å€
external-controller: 127.0.0.1:9090
secret: 1j8Dm52W2nS4aV69Fw15
# é…ç½® WEB UI ç›®å½•ï¼Œä½¿ç”¨ http://{{external-controller}}/ui è®¿é—®
external-ui: MetaCubeXD
external-ui-url: "https://ghproxy.net/https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"

unified-delay: false
#  TCP å¹¶å‘è¿æ¥æ‰€æœ‰ IP, å°†ä½¿ç”¨æœ€å¿«æ¡æ‰‹çš„ TCP
tcp-concurrent: true

global-client-fingerprint: chrome
#  TCP keep alive interval
keep-alive-interval: 30


profile:
  # å­˜å‚¨ select é€‰æ‹©è®°å½•
  store-selected: false
   # æŒä¹…åŒ– fake-ip
  store-fake-ip: false

tun:
  enable: false
  stack: system
  auto-route: true
  auto-detect-interface: true
  strict_route: true
  dns-hijack:
    - any:53

sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: false
  sniff:
    HTTP:
      ports: [80]
      override-destination: true
    TLS:
      ports: [443]
    QUIC:
      ports: [443]
  # force-domain:
  #   - +.v2ex.com
  # skip-domain:
  #   - Mijia Cloud

dns:
  enable: true
  prefer-h3: true
  listen: 0.0.0.0:53
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "+.stun.*.*"
    - "+.stun.*.*.*"
    - "+.stun.*.*.*.*"
    - "+.stun.*.*.*.*.*"
    - "*.n.n.srv.nintendo.net"
    - "+.stun.playstation.net"
    - "xbox.*.*.microsoft.com"
    - "+.xboxlive.com"
    - "+.msftncsi.com"
    - "+.msftconnecttest.com"
    - WORKGROUP
    - "connect.rom.miui.com"
    - "connectivitycheck.platform.hicloud.com"
    - "wifi.vivo.com.cn"
    - "www.qualcomm.cn"
    - "+.ntp.org.cn"
    - "+.pool.ntp.org"
    - "ntp.aliyun.com"
    - "ntp.ntsc.ac.cn"
    - "ntp.tencent.com"
    - "time.apple.com"
    - "time.windows.com"
  default-nameserver:
    - 223.5.5.5
    - 8.8.8.8
  # æ›´å¤š DNS å‚è€ƒ: https://senzyo.pages.dev/2022-22/
  nameserver-policy:
    "geosite:cn":
      - tls://223.5.5.5
      - tls://1.12.12.12
      - https://223.5.5.5/dns-query
      - https://1.12.12.12/dns-query
  nameserver:
    - "tls://8.8.8.8#ğŸŒ æ—¥éŸ©å°æ–°"
    - "tls://1.1.1.1#ğŸŒ æ—¥éŸ©å°æ–°"
    - "https://8.8.8.8/dns-query#ğŸŒ æ—¥éŸ©å°æ–°"
    - "https://1.1.1.1/dns-query#ğŸŒ æ—¥éŸ©å°æ–°"
  proxy-server-nameserver:
    - tls://8.8.8.8
    - tls://1.1.1.1
    - https://8.8.8.8/dns-query
    - https://1.1.1.1/dns-query


proxy-groups:
  - name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©
    type: select
    disable-udp: false
    proxies:
      - ğŸŒ æ—¥éŸ©å°æ–°
      - DIRECT
      - ğŸ“Œ æ‰‹åŠ¨åˆ‡æ¢
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
      - ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹
      - ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹
      - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹
      - ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹
  - name: ğŸ“Œ æ‰‹åŠ¨åˆ‡æ¢
    type: select
    disable-udp: false
    exclude-filter: "å‰©ä½™|æµé‡|æœ‰æ•ˆ|æ—¶é—´|åˆ°æœŸ|expire|åœ°å€|ç½‘å€|å®˜ç½‘"
    use:
      - Provider
  - name: ğŸŒ æ—¥éŸ©å°æ–°
    type: url-test
    disable-udp: false
    # æµ‹è¯•èŠ‚ç‚¹å»¶è¿Ÿçš„æ—¶é—´é—´éš”, å•ä½ä¸º s, æ­¤å¤„ä»…å½±å“ proxies ä¸‹çš„èŠ‚ç‚¹, ä¸å½±å“ use ä¸‹çš„èŠ‚ç‚¹
    # interval: 300
    # lazy é»˜è®¤ä¸º true, æœªé€‰æ‹©åˆ°å½“å‰ç­–ç•¥ç»„æ—¶,åˆ™ä¸ä¼šè¿›è¡Œæµ‹è¯•
    # lazy: false
    # å½“ (æŸä¸€èŠ‚ç‚¹çš„å»¶è¿Ÿ) < (å½“å‰èŠ‚ç‚¹çš„å»¶è¿Ÿ-å®¹å·®) æ—¶, æ‰ä¼šåˆ‡æ¢åˆ°æ–°çš„èŠ‚ç‚¹ã€‚é»˜è®¤å€¼ä¸º 0ms, å¯é€‰é¡¹
    # tolerance: 20
    url: "https://www.gstatic.com/generate_204"
    filter: "ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|JP|Japan|ğŸ‡°ğŸ‡·|éŸ©å›½|KR|South Korea|ğŸ‡¹ğŸ‡¼|å°æ¹¾|TW|Taiwan|ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|SG|Singapore"
    use:
      - Provider
  - name: ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
    type: url-test
    disable-udp: false
    url: "https://www.gstatic.com/generate_204"
    filter: "ğŸ‡­ğŸ‡°|é¦™æ¸¯|HK|Hong Kong"
    use:
      - Provider
  - name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
    type: url-test
    disable-udp: false
    url: "https://www.gstatic.com/generate_204"
    filter: "ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|JP|Japan"
    use:
      - Provider
  - name: ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹
    type: url-test
    disable-udp: false
    url: "https://www.gstatic.com/generate_204"
    filter: "ğŸ‡°ğŸ‡·|éŸ©å›½|KR|South Korea"
    use:
      - Provider
  - name: ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹
    type: url-test
    disable-udp: false
    url: "https://www.gstatic.com/generate_204"
    filter: "ğŸ‡¹ğŸ‡¼|å°æ¹¾|TW|Taiwan"
    use:
      - Provider
  - name: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹
    type: url-test
    disable-udp: false
    url: "https://www.gstatic.com/generate_204"
    filter: "ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|SG|Singapore"
    use:
      - Provider
  - name: ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹
    type: url-test
    disable-udp: false
    url: "https://www.gstatic.com/generate_204"
    filter: "ğŸ‡ºğŸ‡¸|ç¾å›½|US|USA|United States"
    use:
      - Provider
  - name: ğŸ¤– Ai
    type: select
    disable-udp: false
    proxies:
      - ğŸŒ æ—¥éŸ©å°æ–°
      - ğŸ“Œ æ‰‹åŠ¨åˆ‡æ¢
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
      - ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹
      - ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹
      - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹
      - ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹
  - name: â˜ï¸ OneDrive
    type: select
    disable-udp: false
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ“Œ æ‰‹åŠ¨åˆ‡æ¢
  - name: ğŸ® æ¸¸æˆå¹³å°
    type: select
    disable-udp: false
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - DIRECT
      - ğŸ“Œ æ‰‹åŠ¨åˆ‡æ¢
      - ğŸŒ æ—¥éŸ©å°æ–°
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
      - ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹
      - ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹
      - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹
      - ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹
  - name: ğŸŸ æ¼ç½‘ä¹‹é±¼
    type: select
    disable-udp: false
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - DIRECT
      - ğŸ“Œ æ‰‹åŠ¨åˆ‡æ¢

rules:
  - DOMAIN-SUFFIX,bard.google.com,ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹
  - DOMAIN-SUFFIX,mangafuna.xyz,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  # GeoSite, https://github.com/MetaCubeX/meta-rules-dat?tab=readme-ov-file#geositedatgeositedb-å†…å®¹
  - GEOSITE,category-ads-all,REJECT
  - GEOIP,private,DIRECT,no-resolve
  - GEOSITE,private,DIRECT
  - RULE-SET,NTPService,DIRECT
  - GEOSITE,tracker,DIRECT
  - GEOSITE,category-games@cn,DIRECT
  - GEOSITE,category-games,ğŸ® æ¸¸æˆå¹³å°
  - GEOSITE,onedrive,â˜ï¸ OneDrive
  - RULE-SET,Clash-Ai.yaml,ğŸ¤– Ai
  - GEOSITE,geolocation-!cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,CloudCN,DIRECT
  - GEOIP,cn,DIRECT,no-resolve
  - GEOSITE,cn,DIRECT
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

proxy-providers:
  Provider:
    type: http
    # å› ä¸º clash premium core æ›´æ–° providers æ—¶ä¸å¸¦ User-Agent, ä¼šé€ æˆæœºåœºè¿”å›çš„è®¢é˜…ä¿¡æ¯å¯èƒ½ä¸ç¬¦åˆ clash çš„æ ¼å¼ã€‚å¯ä»¥åœ¨è®¢é˜…è¿æ¥åæ·»åŠ  `&flag=clash` æ¥æŒ‡å®šã€‚
    # è€Œ clash meta core å› ä¸ºæœ‰ global-ua è®¾ç½®é¡¹, ä¸€èˆ¬ä¸ç”¨æ·»åŠ  `&flag=clash` æ¥æŒ‡å®š, ä½†æ˜¯æœ‰çš„æœºåœºéœ€è¦æ·»åŠ  `&flag=clashmeta` æ¥æŒ‡å®šã€‚
    url: "https://example.com/xxx&flag=clashmeta"
    # æ›´æ–°è®¢é˜…çš„æ—¶é—´é—´éš”, å•ä½ä¸º s
    interval: 43200
    path: ./Provider.yaml
    health-check:
      enable: true
      # æµ‹è¯•èŠ‚ç‚¹å»¶è¿Ÿçš„æ—¶é—´é—´éš”, å•ä½ä¸º s, æ­¤å¤„ä»…å½±å“ proxy-group ä¸­ use ä¸‹çš„èŠ‚ç‚¹
      interval: 300
      lazy: false
      url: https://www.gstatic.com/generate_204

rule-providers:
  Clash-Ai.yaml:
    type: http
    behavior: classical
    url: https://ghproxy.net/https://gist.githubusercontent.com/senzyo/ba4885ed6b5e4b01f401fa3755d3a27d/raw/Clash-Ai.yaml
    path: ./rule-providers/Clash-Ai.yaml
    # æ›´æ–°è§„åˆ™çš„æ—¶é—´é—´éš”, å•ä½ä¸º s
    interval: 604800
  NTPService:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/NTPService/NTPService.yaml
    path: ./rule-providers/NTPService.yaml
    interval: 604800
  CloudCN:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Cloud/CloudCN/CloudCN.yaml
    path: ./rule-providers/CloudCN.yaml
    interval: 604800
